<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>
    <ul id="recordingslist2"></ul>
    <script src="https://www.gstatic.com/firebasejs/4.1.3/firebase.js"></script>
    <script>
        var config = {
            apiKey: "AIzaSyD-hYIApkFby9GRHEe6RVQ8gs-YKZylY44",
            authDomain: "glenda-174ee.firebaseapp.com",
            databaseURL: "https://glenda-174ee.firebaseio.com",
            projectId: "glenda-174ee",
            storageBucket: "glenda-174ee.appspot.com",
            messagingSenderId: "1035646158453"
        };
        firebase.initializeApp(config);
    </script>
    <script>
        var storageDatabase = firebase.database().ref();
        storageDatabase.on('value', data => {
                const tokenArray = [];
                let soundTrack = data.val();
                let lastSoundTrack = Object.keys(soundTrack).slice(-1);
                for (x in soundTrack) {
                    if (x == lastSoundTrack) {
                        let y = soundTrack[x].name;
                        tokenArray.unshift(y);
                        localStorage.clear();
                        localStorage.setItem('array', tokenArray);
                    }
                }
            })
            //retrieve it from firebase
        let newArray = localStorage.getItem('array');
        console.log(localStorage)
        console.log(newArray)
        var storage = firebase.storage();
        storage.ref().child(`sound/${newArray}`).getDownloadURL().then(function(url) {
            let li = `<li><audio controls class='audio'>
                            <source src="${url}" type="audio/wav">
                                </audio></li>`
            document.querySelector('ul').insertAdjacentHTML('beforeend', li)
            document.querySelector('.audio').play();
            document.querySelector('.audio').addEventListener('ended', function() {
                location.reload();
            })
        }).catch(function(error) {
            location.reload();
        });
    </script>
</body>

</html>